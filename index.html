<!DOCTYPE html>

<html>

<head>

	<script src="node_modules/tweakpane/dist/tweakpane.min.js"></script>
	<script src="node_modules/chroma-js/chroma.min.js"></script>
	<script src="common.js"></script>
	<script src="cca-1d.js"></script>
	<script src="cca-2d.js"></script>
	<script src="entropy.js"></script>
	<script>

		var toolbar;
		const PARAMS = {
			art: '2',
			cca1dColorCount: 4,
			cca2dColorCount: 8,
			cca2dThreshold: 2,
			cca2dResolution: 4,
			entropyColorCount: 4,
			entropyResolution: 8,
		};
		var artSelector;
		var settings;
		var restBtn;
		var startBtn;

		var CCA1Dcontext;
		var CCA2Dcontext;
		var entropyContext;

		window.onload = function () {

			initTweakPane();

			toolbar.addInput(
				PARAMS, 'cca2dColorCount',
				{ min: 2, max: 37, step: 1 }
			);
			toolbar.addInput(
				PARAMS, 'cca2dThreshold',
				{ min: 1, max: 8, step: 1 }
			);
			toolbar.addInput(
				PARAMS, 'cca2dResolution',
				{ min: 4, max: 10, step: 1 }
			);
			resetBtn = toolbar.addButton({
				title: 'Reset with those values',
			});
			toolbar.addSeparator();
			var resetBtn;
			var startBtn = toolbar.addButton({
				title: 'Start',
			});

			resetContext();

			artSelector.on('change', function (value) {

				initTweakPane();

				if (value == "1") {
					toolbar.addInput(
						PARAMS, 'cca1dColorCount',
						{ min: 2, max: 37, step: 1 }
					);
					startBtn = toolbar.addButton({
						title: 'Start1',
					});
				}

				else if (value == "2") {
					toolbar.addInput(
						PARAMS, 'cca2dColorCount',
						{ min: 2, max: 37, step: 1 }
					);
					toolbar.addInput(
						PARAMS, 'cca2dThreshold',
						{ min: 1, max: 8, step: 1 }
					);
					toolbar.addInput(
						PARAMS, 'cca2dResolution',
						{ min: 4, max: 10, step: 1 }
					);
					resetBtn = toolbar.addButton({
						title: 'Reset with those values',
					});
					toolbar.addSeparator();
					startBtn = toolbar.addButton({
						title: 'Start2',
					});
				}

				else if (value == "E") {
					toolbar.addInput(
						PARAMS, 'entropyColorCount',
						{ min: 2, max: 42, step: 1 }
					);
					toolbar.addInput(
						PARAMS, 'entropyResolution',
						{ min: 6, max: 10, step: 1 }
					);
					resetBtn = toolbar.addButton({
						title: 'Reset with those values',
					});
					toolbar.addSeparator();
					startBtn = toolbar.addButton({
						title: 'StartE',
					});
				}

				resetContext();

			});

			resetBtn.on('click', () => {
				clearInterval(CCA1DrenderInterval);
				clearInterval(CCA2DrenderInterval);
				clearInterval(entropyRenderInterval);
				resetContext();
			});

			startBtn.on('click', () => {
				if (settings.art == '1') {
					CCA1Dstart(CCA1Dcontext);
				}
				else if (settings.art == '2') {
					CCA2Dstart(CCA2Dcontext, 400);
				}
				else if (settings.art == 'E') {
					entropyStart(entropyContext, 2500);
				}
			});

		}

		function resetContext() {
			settings = toolbar.exportPreset();
			settings.canvasEl = document.getElementById('canvas');
			settings.width = window.innerWidth;
			settings.height = window.innerHeight;
			if (settings.art == '1') {
				CCA1Dcontext = CCA1DcreateContext(settings);
			}
			else if (settings.art == '2') {
				CCA2Dcontext = CCA2DcreateContext(settings);
			}
			else if (settings.art == 'E') {
				entropyContext = entropyCreateContext(settings);
			}
		}

		function initTweakPane() {
			toolbar = new Tweakpane();
			artSelector = toolbar.addInput(
				PARAMS, 'art',
				{
					options:
					{
						"1 dimension Cyclic Cellular Automaton": '1',
						"2 dimensions Cyclic Cellular Automaton": '2',
						"2 dimensions Entropy Automaton": "E"
					}
				}
			);
			toolbar.addSeparator();
		}

	</script>

	<link href="styles.css" type="text/css" rel="stylesheet" />

</head>

<body>

	<canvas id="canvas"></canvas>

</body>

</html>